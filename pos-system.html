<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Single Product POS System</title>
    <style>
        /* Combined CSS from both pos-system.html and auth.html */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
        }

        /* POS System Styles */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 0 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .nav-tabs {
            display: flex;
            background-color: var(--dark);
            overflow-x: auto;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            color: white;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .tab.active {
            border-bottom: 3px solid var(--secondary);
            background-color: rgba(255, 255, 255, 0.1);
        }

        .tab-content {
            display: none;
            padding: 20px;
            background-color: white;
            border-radius: 0 0 5px 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .card-header {
            background-color: var(--light);
            padding: 15px;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
        }

        .card-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
        }

        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--light);
            font-weight: 600;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .dashboard-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .dashboard-card .value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        .dashboard-card.warning .value {
            color: var(--warning);
        }

        .dashboard-card.danger .value {
            color: var(--danger);
        }

        .dashboard-card.success .value {
            color: var(--success);
        }

        .currency::before {
            content: "GH₵ ";
        }

        /* Authentication Styles */
        .auth-screen {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .auth-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
            overflow: hidden;
        }

        .auth-header {
            background-color: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .auth-tabs {
            display: flex;
            background-color: var(--dark);
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .auth-tab.active {
            background-color: var(--secondary);
            font-weight: bold;
        }

        .auth-content {
            padding: 25px;
        }

        .auth-content input {
            padding: 12px;
            transition: border-color 0.3s;
        }

        .auth-content input:focus {
            border-color: var(--secondary);
            outline: none;
        }

        .auth-content button:hover {
            background-color: var(--primary);
        }

        .welcome-container {
            text-align: center;
            padding: 30px;
        }

        .welcome-container h1 {
            color: var(--primary);
            margin-bottom: 20px;
        }

        .welcome-container p {
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .welcome-buttons {
            display: flex;
            gap: 15px;
        }

        .welcome-buttons button {
            flex: 1;
        }

        .btn-secondary {
            background-color: var(--dark);
        }

        .btn-secondary:hover {
            background-color: var(--primary);
        }

        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 5px;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication UI -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <!-- Welcome Screen -->
            <div id="welcomeScreen">
                <div class="auth-header">
                    <h2>Single Product POS</h2>
                </div>
                <div class="welcome-container">
                    <h1>Welcome to Your POS System</h1>
                    <p>Manage your inventory, track sales, and handle customer credits all in one place. Get started by signing up or logging in to your account.</p>
                    <div class="welcome-buttons">
                        <button id="goToLogin" class="btn-secondary">Login</button>
                        <button id="goToSignup">Sign Up</button>
                    </div>
                </div>
            </div>

            <!-- Login Screen -->
            <div id="loginScreen" class="hidden">
                <div class="auth-header">
                    <h2>Login to Your Account</h2>
                </div>
                <div class="auth-tabs">
                    <div class="auth-tab active" id="loginTab">Login</div>
                    <div class="auth-tab" id="signupTab">Sign Up</div>
                </div>
                <div class="auth-content">
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="loginEmail">Email Address</label>
                            <input type="email" id="loginEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" required>
                        </div>
                        <div id="loginError" class="error-message hidden">Invalid email or password</div>
                        <button type="submit">Login</button>
                    </form>
                </div>
            </div>

            <!-- Signup Screen -->
            <div id="signupScreen" class="hidden">
                <div class="auth-header">
                    <h2>Create New Account</h2>
                </div>
                <div class="auth-tabs">
                    <div class="auth-tab" id="loginTab2">Login</div>
                    <div class="auth-tab active" id="signupTab2">Sign Up</div>
                </div>
                <div class="auth-content">
                    <form id="signupForm">
                        <div class="form-group">
                            <label for="signupName">Business Name</label>
                            <input type="text" id="signupName" required>
                        </div>
                        <div class="form-group">
                            <label for="signupEmail">Email Address</label>
                            <input type="email" id="signupEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="signupPassword">Password</label>
                            <input type="password" id="signupPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <input type="password" id="confirmPassword" required>
                        </div>
                        <div id="signupError" class="error-message hidden">Passwords don't match</div>
                        <button type="submit">Create Account</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- POS System UI (hidden until authenticated) -->
    <div id="posSystem" class="hidden">
        <header>
            <div class="header-content">
                <div class="logo">Single Product POS</div>
                <div id="currentDateTime"></div>
                <button onclick="logout()" style="background: var(--danger); padding: 8px 15px; border: none; color: white; border-radius: 4px; cursor: pointer;">
                    Logout
                </button>
            </div>
        </header>

        <div class="nav-tabs">
            <div class="tab active" data-tab="dashboard">Dashboard</div>
            <div class="tab" data-tab="inventory">Inventory Management</div>
            <div class="tab" data-tab="sales">Sales Transactions</div>
            <div class="tab" data-tab="credit">Credit Management</div>
            <div class="tab" data-tab="customers">Customers</div>
            <div class="tab" data-tab="reports">Reports</div>
        </div>

        <div class="container">
            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard">
                <h2>Business Overview</h2>
                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <h3>Current Stock</h3>
                        <div class="value" id="currentStock">0</div>
                    </div>
                    <div class="dashboard-card">
                        <h3>Today's Sales</h3>
                        <div class="value currency" id="todaySales">0.00</div>
                    </div>
                    <div class="dashboard-card warning">
                        <h3>Low Stock Alert</h3>
                        <div class="value" id="lowStockAlert">0</div>
                    </div>
                    <div class="dashboard-card danger">
                        <h3>Total Credit</h3>
                        <div class="value currency" id="totalCredit">0.00</div>
                    </div>
                    <div class="dashboard-card success">
                        <h3>Total Profit Today</h3>
                        <div class="value currency" id="totalProfit">0.00</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Recent Transactions</div>
                    <div class="card-body">
                        <table id="recentTransactions">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Quantity</th>
                                    <th>Amount</th>
                                    <th>Customer</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Credit Alerts</div>
                    <div class="card-body">
                        <div id="creditAlerts"></div>
                    </div>
                </div>
            </div>

            <!-- Inventory Management Tab -->
            <div class="tab-content" id="inventory">
                <h2>Inventory Management</h2>
                <div class="card">
                    <div class="card-header">Add New Stock</div>
                    <div class="card-body">
                        <form id="addStockForm">
                            <div class="form-group">
                                <label for="stockDate">Date Received</label>
                                <input type="datetime-local" id="stockDate" required>
                            </div>
                            <div class="form-group">
                                <label for="quantityReceived">Quantity Received</label>
                                <input type="number" id="quantityReceived" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="costPrice">Cost Price per Unit (GH₵)</label>
                                <input type="number" id="costPrice" min="0.01" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="sellingPrice">Selling Price per Unit (GH₵)</label>
                                <input type="number" id="sellingPrice" min="0.01" step="0.01" required>
                            </div>
                            <button type="submit" class="btn-primary">Add Stock</button>
                        </form>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Current Inventory</div>
                    <div class="card-body">
                        <table id="inventoryTable">
                            <thead>
                                <tr>
                                    <th>Date Received</th>
                                    <th>Quantity</th>
                                    <th>Cost Price</th>
                                    <th>Selling Price</th>
                                    <th>Remaining</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Sales Transactions Tab -->
            <div class="tab-content" id="sales">
                <h2>Sales Transactions</h2>
                <div class="card">
                    <div class="card-header">New Sale</div>
                    <div class="card-body">
                        <form id="saleForm">
                            <div class="form-group">
                                <label for="saleDate">Date Sold</label>
                                <input type="datetime-local" id="saleDate" required>
                            </div>
                            <div class="form-group">
                                <label for="saleType">Sale Type</label>
                                <select id="saleType" required>
                                    <option value="Cash">Cash</option>
                                    <option value="Credit">Credit</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="customerSelect">Customer</label>
                                <select id="customerSelect" required>
                                    <option value="">Select Customer</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="saleQuantity">Quantity</label>
                                <input type="number" id="saleQuantity" min="1" required>
                            </div>
                            <div class="form-group" id="amountPaidGroup">
                                <label for="amountPaid">Amount Paid (GH₵)</label>
                                <input type="number" id="amountPaid" min="0" step="0.01" required>
                            </div>
                            <div class="form-group" id="amountOwedGroup" style="display: none;">
                                <label for="amountOwed">Amount Owed (GH₵)</label>
                                <input type="number" id="amountOwed" min="0" step="0.01" readonly>
                            </div>
                            <button type="submit" class="btn-primary">Process Sale</button>
                        </form>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Recent Sales</div>
                    <div class="card-body">
                        <table id="salesTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Customer</th>
                                    <th>Quantity</th>
                                    <th>Amount Paid</th>
                                    <th>Amount Owed</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Credit Management Tab -->
            <div class="tab-content" id="credit">
                <h2>Credit Management</h2>
                <div class="card">
                    <div class="card-header">Credit Payments</div>
                    <div class="card-body">
                        <form id="creditPaymentForm">
                            <div class="form-group">
                                <label for="creditCustomer">Customer</label>
                                <select id="creditCustomer" required>
                                    <option value="">Select Customer</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="paymentAmount">Payment Amount (GH₵)</label>
                                <input type="number" id="paymentAmount" min="0.01" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="paymentDate">Payment Date</label>
                                <input type="datetime-local" id="paymentDate" required>
                            </div>
                            <div class="form-group">
                                <label for="paymentNote">Notes</label>
                                <textarea id="paymentNote"></textarea>
                            </div>
                            <button type="submit" class="btn-success">Record Payment</button>
                        </form>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Outstanding Credits</div>
                    <div class="card-body">
                        <table id="creditsTable">
                            <thead>
                                <tr>
                                    <th>Customer</th>
                                    <th>Total Owed</th>
                                    <th>Last Payment</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Credit Payment History</div>
                    <div class="card-body">
                        <table id="creditPaymentsTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>Note</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Customers Tab -->
            <div class="tab-content" id="customers">
                <h2>Customer Management</h2>
                <div class="card">
                    <div class="card-header">Add New Customer</div>
                    <div class="card-body">
                        <form id="customerForm">
                            <div class="form-group">
                                <label for="customerName">Customer Name</label>
                                <input type="text" id="customerName" required>
                            </div>
                            <div class="form-group">
                                <label for="phoneNumber">Phone Number</label>
                                <input type="text" id="phoneNumber" required>
                            </div>
                            <div class="form-group">
                                <label for="address">Address</label>
                                <textarea id="address"></textarea>
                            </div>
                            <button type="submit" class="btn-primary">Add Customer</button>
                        </form>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">All Customers</div>
                    <div class="card-body">
                        <table id="customersTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Phone</th>
                                    <th>Address</th>
                                    <th>Total Credit</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div class="tab-content" id="reports">
                <h2>Business Reports</h2>
                <div class="card">
                    <div class="card-header">Generate Report</div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="reportType">Report Type</label>
                            <select id="reportType">
                                <option value="sales">Sales Report</option>
                                <option value="inventory">Inventory Report</option>
                                <option value="credit">Credit Report</option>
                                <option value="profit">Profit Report</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportDateFrom">From Date</label>
                            <input type="date" id="reportDateFrom">
                        </div>
                        <div class="form-group">
                            <label for="reportDateTo">To Date</label>
                            <input type="date" id="reportDateTo">
                        </div>
                        <button class="btn-primary" id="generateReport">Generate Report</button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Report Results</div>
                    <div class="card-body">
                        <div id="reportResults"></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Data Management</div>
                    <div class="card-body">
                        <button onclick="DB.backupData()" class="btn-primary" style="margin-bottom: 10px;">Backup Data</button>
                        <p>Download a backup of all your data</p>
                        <div style="margin-top: 20px;">
                            <h3>Restore Data</h3>
                            <input type="file" id="restoreFile" accept=".json">
                            <button onclick="DB.restoreData()" class="btn-warning" style="margin-top: 10px;">Restore Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simple hash function (not secure for production)
        function simpleHash(str) {
            if (!str) return 'default';
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = (hash << 5) - hash + char;
                hash |= 0; // Convert to 32bit integer
            }
            return hash.toString();
        }

        // Get user-specific storage key
        function getUserKey(baseKey) {
            try {
                const currentUser = JSON.parse(localStorage.getItem('posCurrentUser'));
                const userHash = currentUser ? simpleHash(currentUser.email) : 'default';
                return `${baseKey}_${userHash}`;
            } catch (e) {
                return `${baseKey}_default`;
            }
        }

        // Show/hide authentication screens
        function showAuthScreen(screen) {
            const welcomeScreen = document.getElementById('welcomeScreen');
            const loginScreen = document.getElementById('loginScreen');
            const signupScreen = document.getElementById('signupScreen');
            const loginError = document.getElementById('loginError');
            const signupError = document.getElementById('signupError');
            const loginTab = document.getElementById('loginTab');
            const signupTab = document.getElementById('signupTab');
            const loginTab2 = document.getElementById('loginTab2');
            const signupTab2 = document.getElementById('signupTab2');

            welcomeScreen.classList.add('hidden');
            loginScreen.classList.add('hidden');
            signupScreen.classList.add('hidden');
            loginError.classList.add('hidden');
            signupError.classList.add('hidden');

            if (screen === 'welcome') {
                welcomeScreen.classList.remove('hidden');
            } else if (screen === 'login') {
                loginScreen.classList.remove('hidden');
                loginTab.classList.add('active');
                signupTab.classList.remove('active');
            } else if (screen === 'signup') {
                signupScreen.classList.remove('hidden');
                signupTab2.classList.add('active');
                loginTab2.classList.remove('active');
            }
        }

        // Show/hide POS system
        function showPOS(show) {
            const authScreen = document.getElementById('authScreen');
            const posSystem = document.getElementById('posSystem');
            if (show) {
                authScreen.classList.add('hidden');
                posSystem.classList.remove('hidden');
            } else {
                authScreen.classList.remove('hidden');
                posSystem.classList.add('hidden');
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem('posCurrentUser');
            showPOS(false);
            showAuthScreen('welcome');
        }

        // Session timeout functionality
        let inactivityTimer;
        function setupInactivityTimer() {
            function resetTimer() {
                clearTimeout(inactivityTimer);
                inactivityTimer = setTimeout(() => {
                    alert('Session expired due to inactivity.');
                    logout();
                }, 30 * 60 * 1000); // 30 minutes
            }

            window.onload = resetTimer;
            document.onmousemove = resetTimer;
            document.onkeypress = resetTimer;
            document.onclick = resetTimer;
            document.onscroll = resetTimer;
            document.onmousedown = resetTimer;
            document.ontouchstart = resetTimer;

            resetTimer();
        }

        // Data storage using localStorage
        const DB = {
            init: function() {
                if (!localStorage.getItem(getUserKey('inventory'))) {
                    localStorage.setItem(getUserKey('inventory'), JSON.stringify([]));
                }
                if (!localStorage.getItem(getUserKey('sales'))) {
                    localStorage.setItem(getUserKey('sales'), JSON.stringify([]));
                }
                if (!localStorage.getItem(getUserKey('customers'))) {
                    localStorage.setItem(getUserKey('customers'), JSON.stringify([]));
                }
                if (!localStorage.getItem(getUserKey('creditPayments'))) {
                    localStorage.setItem(getUserKey('creditPayments'), JSON.stringify([]));
                }

                this.updateDashboard();
                this.loadInventory();
                this.loadSales();
                this.loadCustomers();
                this.loadCreditPayments();
                this.loadCredits();

                this.updateDateTime();
                setInterval(this.updateDateTime, 1000);
            },

            updateDateTime: function() {
                const now = new Date();
                document.getElementById('currentDateTime').textContent = now.toLocaleString();
            },

            addInventory: function(date, quantity, costPrice, sellingPrice) {
                if (quantity <= 0 || costPrice <= 0 || sellingPrice <= 0) {
                    alert('Please enter valid positive values for quantity, cost price, and selling price.');
                    return;
                }
                const inventory = JSON.parse(localStorage.getItem(getUserKey('inventory')) || '[]');
                const newItem = {
                    id: inventory.length > 0 ? Math.max(...inventory.map(item => item.id)) + 1 : 1,
                    date: date,
                    quantity: parseInt(quantity),
                    costPrice: parseFloat(costPrice),
                    sellingPrice: parseFloat(sellingPrice),
                    remaining: parseInt(quantity)
                };
                inventory.push(newItem);
                localStorage.setItem(getUserKey('inventory'), JSON.stringify(inventory));
                this.loadInventory();
                this.updateDashboard();
                alert('Stock added successfully!');
                document.getElementById('addStockForm').reset();
            },

            loadInventory: function() {
                const inventory = JSON.parse(localStorage.getItem(getUserKey('inventory')) || '[]');
                const tbody = document.getElementById('inventoryTable').querySelector('tbody');
                tbody.innerHTML = '';
                inventory.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${new Date(item.date).toLocaleString()}</td>
                        <td>${item.quantity}</td>
                        <td>GH₵ ${item.costPrice.toFixed(2)}</td>
                        <td>GH₵ ${item.sellingPrice.toFixed(2)}</td>
                        <td>${item.remaining}</td>
                    `;
                    tbody.appendChild(row);
                });
            },

            addCustomer: function(name, phone, address) {
                if (!name.trim() || !phone.trim()) {
                    alert('Customer name and phone number are required.');
                    return;
                }
                const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                const newCustomer = {
                    id: customers.length > 0 ? Math.max(...customers.map(c => c.id)) + 1 : 1,
                    name: name.trim(),
                    phone: phone.trim(),
                    address: address.trim() || ''
                };
                customers.push(newCustomer);
                localStorage.setItem(getUserKey('customers'), JSON.stringify(customers));
                this.loadCustomers();
                alert('Customer added successfully!');
                document.getElementById('customerForm').reset();
            },

            updateCustomer: function(id, name, phone, address) {
                const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                const customer = customers.find(c => c.id === id);
                if (customer) {
                    customer.name = name.trim();
                    customer.phone = phone.trim();
                    customer.address = address.trim() || '';
                    localStorage.setItem(getUserKey('customers'), JSON.stringify(customers));
                    this.loadCustomers();
                    alert('Customer updated successfully!');
                }
            },

            deleteCustomer: function(id) {
                const sales = JSON.parse(localStorage.getItem(getUserKey('sales')) || '[]');
                const payments = JSON.parse(localStorage.getItem(getUserKey('creditPayments')) || '[]');
                if (sales.some(s => s.customerId === id) || payments.some(p => p.customerId === id)) {
                    alert('Cannot delete customer with associated sales or payments.');
                    return;
                }
                if (confirm('Are you sure you want to delete this customer?')) {
                    const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                    const updatedCustomers = customers.filter(c => c.id !== id);
                    localStorage.setItem(getUserKey('customers'), JSON.stringify(updatedCustomers));
                    this.loadCustomers();
                    alert('Customer deleted successfully!');
                }
            },

            loadCustomers: function() {
                const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                const tbody = document.getElementById('customersTable').querySelector('tbody');
                tbody.innerHTML = '';
                const customerSelect = document.getElementById('customerSelect');
                const creditCustomer = document.getElementById('creditCustomer');
                while (customerSelect.options.length > 1) {
                    customerSelect.remove(1);
                }
                while (creditCustomer.options.length > 1) {
                    creditCustomer.remove(1);
                }
                customers.forEach(customer => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${customer.name}</td>
                        <td>${customer.phone}</td>
                        <td>${customer.address || '-'}</td>
                        <td>GH₵ ${this.getCustomerCredit(customer.id).toFixed(2)}</td>
                        <td>
                            <button class="btn-warning" onclick="DB.editCustomer(${customer.id})">Edit</button>
                            <button class="btn-danger" onclick="DB.deleteCustomer(${customer.id})">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                    const option = document.createElement('option');
                    option.value = customer.id;
                    option.textContent = customer.name;
                    customerSelect.appendChild(option.cloneNode(true));
                    creditCustomer.appendChild(option);
                });
            },

            editCustomer: function(id) {
                const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                const customer = customers.find(c => c.id === id);
                if (customer) {
                    const name = prompt('Enter customer name:', customer.name);
                    const phone = prompt('Enter phone number:', customer.phone);
                    const address = prompt('Enter address:', customer.address);
                    if (name && phone) {
                        this.updateCustomer(id, name, phone, address);
                    } else {
                        alert('Name and phone number are required.');
                    }
                }
            },

            addSale: function(date, type, customerId, quantity, amountPaid, amountOwed) {
                const inventory = JSON.parse(localStorage.getItem(getUserKey('inventory')) || '[]');
                const currentStock = this.getCurrentStock();
                if (quantity > currentStock) {
                    alert(`Insufficient stock. Available: ${currentStock}, Requested: ${quantity}`);
                    return;
                }
                if (quantity <= 0 || amountPaid < 0 || amountOwed < 0) {
                    alert('Please enter valid values for quantity and amounts.');
                    return;
                }
                const sales = JSON.parse(localStorage.getItem(getUserKey('sales')) || '[]');
                const newSale = {
                    id: sales.length > 0 ? Math.max(...sales.map(s => s.id)) + 1 : 1,
                    date: date,
                    type: type,
                    customerId: parseInt(customerId),
                    quantity: parseInt(quantity),
                    amountPaid: parseFloat(amountPaid),
                    amountOwed: parseFloat(amountOwed)
                };
                let remainingQty = parseInt(quantity);
                for (let i = 0; i < inventory.length && remainingQty > 0; i++) {
                    if (inventory[i].remaining > 0) {
                        const deduct = Math.min(inventory[i].remaining, remainingQty);
                        inventory[i].remaining -= deduct;
                        remainingQty -= deduct;
                    }
                }
                sales.push(newSale);
                localStorage.setItem(getUserKey('sales'), JSON.stringify(sales));
                localStorage.setItem(getUserKey('inventory'), JSON.stringify(inventory));
                this.loadSales();
                this.loadInventory();
                this.updateDashboard();
                alert('Sale recorded successfully!');
                document.getElementById('saleForm').reset();
            },

            loadSales: function() {
                const sales = JSON.parse(localStorage.getItem(getUserKey('sales')) || '[]');
                const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                const tbody = document.getElementById('salesTable').querySelector('tbody');
                tbody.innerHTML = '';
                sales.forEach(sale => {
                    const customer = customers.find(c => c.id === sale.customerId) || { name: 'Unknown' };
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${new Date(sale.date).toLocaleString()}</td>
                        <td>${sale.type}</td>
                        <td>${customer.name}</td>
                        <td>${sale.quantity}</td>
                        <td>GH₵ ${sale.amountPaid.toFixed(2)}</td>
                        <td>GH₵ ${sale.amountOwed.toFixed(2)}</td>
                    `;
                    tbody.appendChild(row);
                });
            },

            addCreditPayment: function(customerId, amount, date, note) {
                if (amount <= 0) {
                    alert('Payment amount must be positive.');
                    return;
                }
                const payments = JSON.parse(localStorage.getItem(getUserKey('creditPayments')) || '[]');
                const newPayment = {
                    id: payments.length > 0 ? Math.max(...payments.map(p => p.id)) + 1 : 1,
                    customerId: parseInt(customerId),
                    date: date,
                    amount: parseFloat(amount),
                    note: note.trim()
                };
                payments.push(newPayment);
                localStorage.setItem(getUserKey('creditPayments'), JSON.stringify(payments));
                this.loadCreditPayments();
                this.loadCredits();
                this.updateDashboard();
                alert('Credit payment recorded successfully!');
                document.getElementById('creditPaymentForm').reset();
            },

            loadCreditPayments: function() {
                const payments = JSON.parse(localStorage.getItem(getUserKey('creditPayments')) || '[]');
                const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                const tbody = document.getElementById('creditPaymentsTable').querySelector('tbody');
                tbody.innerHTML = '';
                payments.forEach(payment => {
                    const customer = customers.find(c => c.id === payment.customerId) || { name: 'Unknown' };
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${new Date(payment.date).toLocaleString()}</td>
                        <td>${customer.name}</td>
                        <td>GH₵ ${payment.amount.toFixed(2)}</td>
                        <td>${payment.note || '-'}</td>
                    `;
                    tbody.appendChild(row);
                });
            },

            loadCredits: function() {
                const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                const payments = JSON.parse(localStorage.getItem(getUserKey('creditPayments')) || '[]');
                const sales = JSON.parse(localStorage.getItem(getUserKey('sales')) || '[]');
                const tbody = document.getElementById('creditsTable').querySelector('tbody');
                tbody.innerHTML = '';
                customers.forEach(customer => {
                    const credit = this.getCustomerCredit(customer.id);
                    if (credit > 0) {
                        const lastPayment = payments
                            .filter(p => p.customerId === customer.id)
                            .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${customer.name}</td>
                            <td>GH₵ ${credit.toFixed(2)}</td>
                            <td>${lastPayment ? new Date(lastPayment.date).toLocaleString() : '-'}</td>
                            <td>
                                <button class="btn-primary" onclick="DB.viewCustomerCredit(${customer.id})">View Details</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    }
                });
            },

            viewCustomerCredit: function(customerId) {
                const sales = JSON.parse(localStorage.getItem(getUserKey('sales')) || '[]');
                const payments = JSON.parse(localStorage.getItem(getUserKey('creditPayments')) || '[]');
                const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                const customer = customers.find(c => c.id === customerId) || { name: 'Unknown' };
                let details = `<h3>Credit Details for ${customer.name}</h3>`;
                details += '<h4>Sales on Credit</h4>';
                const creditSales = sales.filter(s => s.customerId === customerId && s.type === 'Credit');
                if (creditSales.length > 0) {
                    details += '<ul>';
                    creditSales.forEach(sale => {
                        details += `<li>${new Date(sale.date).toLocaleString()}: ${sale.quantity} units, Owed: GH₵ ${sale.amountOwed.toFixed(2)}</li>`;
                    });
                    details += '</ul>';
                } else {
                    details += '<p>No credit sales found.</p>';
                }
                details += '<h4>Payments</h4>';
                const customerPayments = payments.filter(p => p.customerId === customerId);
                if (customerPayments.length > 0) {
                    details += '<ul>';
                    customerPayments.forEach(payment => {
                        details += `<li>${new Date(payment.date).toLocaleString()}: GH₵ ${payment.amount.toFixed(2)} (${payment.note || 'No note'})</li>`;
                    });
                    details += '</ul>';
                } else {
                    details += '<p>No payments found.</p>';
                }
                alert(details);
            },

            getCurrentStock: function() {
                const inventory = JSON.parse(localStorage.getItem(getUserKey('inventory')) || '[]');
                return inventory.reduce((total, item) => total + item.remaining, 0);
            },

            getCurrentSellingPrice: function() {
                const inventory = JSON.parse(localStorage.getItem(getUserKey('inventory')) || '[]');
                const availableItems = inventory.filter(item => item.remaining > 0);
                return availableItems.length > 0 ? availableItems[0].sellingPrice : 0;
            },

            getCustomerCredit: function(customerId) {
                const sales = JSON.parse(localStorage.getItem(getUserKey('sales')) || '[]');
                const payments = JSON.parse(localStorage.getItem(getUserKey('creditPayments')) || '[]');
                const customerSales = sales.filter(s => s.customerId === customerId && s.type === 'Credit');
                const totalOwed = customerSales.reduce((total, sale) => total + sale.amountOwed, 0);
                const customerPayments = payments.filter(p => p.customerId === customerId);
                const totalPaid = customerPayments.reduce((total, payment) => total + payment.amount, 0);
                return totalOwed - totalPaid;
            },

            getTotalCredit: function() {
                const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                return customers.reduce((total, customer) => total + this.getCustomerCredit(customer.id), 0);
            },

            getTodaySales: function() {
                const sales = JSON.parse(localStorage.getItem(getUserKey('sales')) || '[]');
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                return sales
                    .filter(sale => new Date(sale.date) >= today)
                    .reduce((total, sale) => total + sale.amountPaid, 0);
            },

            getTodayProfit: function() {
                const sales = JSON.parse(localStorage.getItem(getUserKey('sales')) || '[]');
                const inventory = JSON.parse(localStorage.getItem(getUserKey('inventory')) || '[]');
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const todaySales = sales.filter(sale => new Date(sale.date) >= today);
                return todaySales.reduce((total, sale) => {
                    const item = inventory.find(i => i.remaining > 0);
                    const costPrice = item ? item.costPrice : 0;
                    const sellingPrice = item ? item.sellingPrice : 0;
                    return total + (sale.quantity * (sellingPrice - costPrice));
                }, 0);
            },

            updateDashboard: function() {
                document.getElementById('currentStock').textContent = this.getCurrentStock();
                document.getElementById('todaySales').textContent = this.getTodaySales().toFixed(2);
                document.getElementById('totalCredit').textContent = this.getTotalCredit().toFixed(2);
                document.getElementById('totalProfit').textContent = this.getTodayProfit().toFixed(2);
                const currentStock = this.getCurrentStock();
                document.getElementById('lowStockAlert').textContent = currentStock < 50 ? currentStock : '0';
                const lowStockElement = document.querySelector('.dashboard-card.warning');
                if (currentStock < 50) {
                    lowStockElement.classList.add('danger');
                } else {
                    lowStockElement.classList.remove('danger');
                }
                const sales = JSON.parse(localStorage.getItem(getUserKey('sales')) || '[]');
                const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                const tbody = document.getElementById('recentTransactions').querySelector('tbody');
                tbody.innerHTML = '';
                const recentSales = sales.slice(-5).reverse();
                recentSales.forEach(sale => {
                    const customer = customers.find(c => c.id === sale.customerId) || { name: 'Unknown' };
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${new Date(sale.date).toLocaleDateString()}</td>
                        <td>${sale.type}</td>
                        <td>${sale.quantity}</td>
                        <td>GH₵ ${(sale.amountPaid + sale.amountOwed).toFixed(2)}</td>
                        <td>${customer.name}</td>
                    `;
                    tbody.appendChild(row);
                });
                const creditAlerts = document.getElementById('creditAlerts');
                creditAlerts.innerHTML = '';
                customers.forEach(customer => {
                    const credit = this.getCustomerCredit(customer.id);
                    if (credit > 0) {
                        const alert = document.createElement('div');
                        alert.className = 'alert alert-warning';
                        alert.textContent = `${customer.name} owes GH₵ ${credit.toFixed(2)}`;
                        creditAlerts.appendChild(alert);
                    }
                });
            },

            backupData: function() {
                const data = {
                    inventory: JSON.parse(localStorage.getItem(getUserKey('inventory')) || '[]'),
                    sales: JSON.parse(localStorage.getItem(getUserKey('sales')) || '[]'),
                    customers: JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]'),
                    creditPayments: JSON.parse(localStorage.getItem(getUserKey('creditPayments')) || '[]')
                };
                const dataStr = JSON.stringify(data);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                const exportFileDefaultName = `pos-backup-${new Date().toISOString().slice(0,10)}.json`;
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            },

            restoreData: function() {
                const fileInput = document.getElementById('restoreFile');
                const file = fileInput.files[0];
                if (!file) {
                    alert('Please select a backup file first.');
                    return;
                }
                if (!confirm('WARNING: This will overwrite all current data. Continue?')) {
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        localStorage.setItem(getUserKey('inventory'), JSON.stringify(data.inventory || []));
                        localStorage.setItem(getUserKey('sales'), JSON.stringify(data.sales || []));
                        localStorage.setItem(getUserKey('customers'), JSON.stringify(data.customers || []));
                        localStorage.setItem(getUserKey('creditPayments'), JSON.stringify(data.creditPayments || []));
                        alert('Data restored successfully! The page will now reload.');
                        location.reload();
                    } catch (error) {
                        alert('Error restoring data: Invalid file format.');
                        console.error(error);
                    }
                };
                reader.readAsText(file);
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements for Authentication
            const goToLoginBtn = document.getElementById('goToLogin');
            const goToSignupBtn = document.getElementById('goToSignup');
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const loginTab = document.getElementById('loginTab');
            const signupTab = document.getElementById('signupTab');
            const loginTab2 = document.getElementById('loginTab2');
            const signupTab2 = document.getElementById('signupTab2');
            const loginError = document.getElementById('loginError');
            const signupError = document.getElementById('signupError');

            // Authentication Event Listeners
            goToLoginBtn.addEventListener('click', () => showAuthScreen('login'));
            goToSignupBtn.addEventListener('click', () => showAuthScreen('signup'));
            loginTab.addEventListener('click', () => showAuthScreen('login'));
            signupTab.addEventListener('click', () => showAuthScreen('signup'));
            loginTab2.addEventListener('click', () => showAuthScreen('login'));
            signupTab2.addEventListener('click', () => showAuthScreen('signup'));

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = simpleHash(document.getElementById('loginPassword').value);
                const users = JSON.parse(localStorage.getItem('posUsers') || '[]');
                const user = users.find(u => u.email === email && u.password === password);
                if (user) {
                    localStorage.setItem('posCurrentUser', JSON.stringify(user));
                    showPOS(true);
                    DB.init();
                    setupInactivityTimer();
                } else {
                    loginError.classList.remove('hidden');
                }
            });

            signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const businessName = document.getElementById('signupName').value;
                const email = document.getElementById('signupEmail').value;
                const password = simpleHash(document.getElementById('signupPassword').value);
                const confirmPassword = simpleHash(document.getElementById('confirmPassword').value);
                if (password !== confirmPassword) {
                    signupError.textContent = "Passwords don't match";
                    signupError.classList.remove('hidden');
                    return;
                }
                const users = JSON.parse(localStorage.getItem('posUsers') || '[]');
                if (users.some(user => user.email === email)) {
                    signupError.textContent = "Email already registered";
                    signupError.classList.remove('hidden');
                    return;
                }
                const newUser = { businessName, email, password };
                users.push(newUser);
                localStorage.setItem('posUsers', JSON.stringify(users));
                localStorage.setItem('posCurrentUser', JSON.stringify(newUser));
                showPOS(true);
                DB.init();
                setupInactivityTimer();
            });

            // POS Event Listeners
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById(this.dataset.tab).classList.add('active');
                });
            });

            document.getElementById('saleType').addEventListener('change', function() {
                const amountPaidGroup = document.getElementById('amountPaidGroup');
                const amountOwedGroup = document.getElementById('amountOwedGroup');
                if (this.value === 'Credit') {
                    amountPaidGroup.style.display = 'block';
                    amountOwedGroup.style.display = 'block';
                } else {
                    amountPaidGroup.style.display = 'block';
                    amountOwedGroup.style.display = 'none';
                    document.getElementById('amountPaid').value = '';
                    document.getElementById('amountOwed').value = '';
                }
            });

            function updateSaleAmounts() {
                const sellingPrice = DB.getCurrentSellingPrice();
                const quantity = parseInt(document.getElementById('saleQuantity').value) || 0;
                const total = quantity * sellingPrice;
                const saleType = document.getElementById('saleType').value;
                if (saleType === 'Credit') {
                    const amountPaid = parseFloat(document.getElementById('amountPaid').value) || 0;
                    document.getElementById('amountOwed').value = (total - amountPaid).toFixed(2);
                } else {
                    document.getElementById('amountPaid').value = total.toFixed(2);
                    document.getElementById('amountOwed').value = '0.00';
                }
            }

            document.getElementById('saleQuantity').addEventListener('input', updateSaleAmounts);
            document.getElementById('amountPaid').addEventListener('input', updateSaleAmounts);

            document.getElementById('addStockForm').addEventListener('submit', function(e) {
                e.preventDefault();
                DB.addInventory(
                    document.getElementById('stockDate').value,
                    document.getElementById('quantityReceived').value,
                    document.getElementById('costPrice').value,
                    document.getElementById('sellingPrice').value
                );
            });

            document.getElementById('customerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                DB.addCustomer(
                    document.getElementById('customerName').value,
                    document.getElementById('phoneNumber').value,
                    document.getElementById('address').value
                );
            });

            document.getElementById('saleForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const saleType = document.getElementById('saleType').value;
                const quantity = parseInt(document.getElementById('saleQuantity').value);
                const sellingPrice = DB.getCurrentSellingPrice();
                const total = quantity * sellingPrice;
                let amountPaid = parseFloat(document.getElementById('amountPaid').value) || 0;
                let amountOwed = 0;
                if (saleType === 'Credit') {
                    amountOwed = total - amountPaid;
                    if (amountOwed < 0) {
                        alert('Amount paid cannot exceed total sale amount.');
                        return;
                    }
                } else {
                    amountPaid = total;
                }
                DB.addSale(
                    document.getElementById('saleDate').value,
                    saleType,
                    document.getElementById('customerSelect').value,
                    quantity,
                    amountPaid,
                    amountOwed
                );
            });

            document.getElementById('creditPaymentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const customerId = parseInt(document.getElementById('creditCustomer').value);
                const paymentAmount = parseFloat(document.getElementById('paymentAmount').value);
                const credit = DB.getCustomerCredit(customerId);
                if (paymentAmount > credit) {
                    alert(`Payment amount (GH₵ ${paymentAmount.toFixed(2)}) exceeds outstanding credit (GH₵ ${credit.toFixed(2)}).`);
                    return;
                }
                DB.addCreditPayment(
                    customerId,
                    paymentAmount,
                    document.getElementById('paymentDate').value,
                    document.getElementById('paymentNote').value
                );
            });

            document.getElementById('generateReport').addEventListener('click', function() {
                const reportType = document.getElementById('reportType').value;
                const fromDate = document.getElementById('reportDateFrom').value;
                const toDate = document.getElementById('reportDateTo').value;
                if (!fromDate || !toDate) {
                    alert('Please select both start and end dates.');
                    return;
                }
                const reportResults = document.getElementById('reportResults');
                let content = `<h3>${reportType.charAt(0).toUpperCase() + reportType.slice(1)} Report</h3>`;
                content += `<p>From: ${fromDate} To: ${toDate}</p>`;
                const from = new Date(fromDate);
                const to = new Date(toDate);
                to.setHours(23, 59, 59, 999);
                if (reportType === 'sales') {
                    const sales = JSON.parse(localStorage.getItem(getUserKey('sales')) || '[]');
                    const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                    const filteredSales = sales.filter(s => {
                        const saleDate = new Date(s.date);
                        return saleDate >= from && saleDate <= to;
                    });
                    content += '<table><thead><tr><th>Date</th><th>Type</th><th>Customer</th><th>Quantity</th><th>Amount Paid</th><th>Amount Owed</th></tr></thead><tbody>';
                    filteredSales.forEach(sale => {
                        const customer = customers.find(c => c.id === sale.customerId) || { name: 'Unknown' };
                        content += `<tr>
                            <td>${new Date(sale.date).toLocaleString()}</td>
                            <td>${sale.type}</td>
                            <td>${customer.name}</td>
                            <td>${sale.quantity}</td>
                            <td>GH₵ ${sale.amountPaid.toFixed(2)}</td>
                            <td>GH₵ ${sale.amountOwed.toFixed(2)}</td>
                        </tr>`;
                    });
                    content += '</tbody></table>';
                } else if (reportType === 'inventory') {
                    const inventory = JSON.parse(localStorage.getItem(getUserKey('inventory')) || '[]');
                    const filteredInventory = inventory.filter(i => {
                        const itemDate = new Date(i.date);
                        return itemDate >= from && itemDate <= to;
                    });
                    content += '<table><thead><tr><th>Date Received</th><th>Quantity</th><th>Cost Price</th><th>Selling Price</th><th>Remaining</th></tr></thead><tbody>';
                    filteredInventory.forEach(item => {
                        content += `<tr>
                            <td>${new Date(item.date).toLocaleString()}</td>
                            <td>${item.quantity}</td>
                            <td>GH₵ ${item.costPrice.toFixed(2)}</td>
                            <td>GH₵ ${item.sellingPrice.toFixed(2)}</td>
                            <td>${item.remaining}</td>
                        </tr>`;
                    });
                    content += '</tbody></table>';
                } else if (reportType === 'credit') {
                    const customers = JSON.parse(localStorage.getItem(getUserKey('customers')) || '[]');
                    content += '<table><thead><tr><th>Customer</th><th>Total Owed</th><th>Last Payment</th></tr></thead><tbody>';
                    customers.forEach(customer => {
                        const credit = DB.getCustomerCredit(customer.id);
                        if (credit > 0) {
                            const lastPayment = JSON.parse(localStorage.getItem(getUserKey('creditPayments')) || '[]')
                                .filter(p => p.customerId === customer.id)
                                .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                            content += `<tr>
                                <td>${customer.name}</td>
                                <td>GH₵ ${credit.toFixed(2)}</td>
                                <td>${lastPayment ? new Date(lastPayment.date).toLocaleString() : '-'}</td>
                            </tr>`;
                        }
                    });
                    content += '</tbody></table>';
                } else if (reportType === 'profit') {
                    const sales = JSON.parse(localStorage.getItem(getUserKey('sales')) || '[]');
                    const inventory = JSON.parse(localStorage.getItem(getUserKey('inventory')) || '[]');
                    const filteredSales = sales.filter(s => {
                        const saleDate = new Date(s.date);
                        return saleDate >= from && saleDate <= to;
                    });
                    const totalProfit = filteredSales.reduce((total, sale) => {
                        const item = inventory.find(i => i.remaining > 0);
                        const costPrice = item ? item.costPrice : 0;
                        const sellingPrice = item ? item.sellingPrice : 0;
                        return total + (sale.quantity * (sellingPrice - costPrice));
                    }, 0);
                    content += `<p>Total Profit: GH₵ ${totalProfit.toFixed(2)}</p>`;
                }
                reportResults.innerHTML = `<div class="alert alert-success">${content}</div>`;
            });

            // Check authentication status
            const currentUser = localStorage.getItem('posCurrentUser');
            if (currentUser) {
                showPOS(true);
                DB.init();
                setupInactivityTimer();
            } else {
                showPOS(false);
                showAuthScreen('welcome');
            }
        });
    </script>
</body>
</html>